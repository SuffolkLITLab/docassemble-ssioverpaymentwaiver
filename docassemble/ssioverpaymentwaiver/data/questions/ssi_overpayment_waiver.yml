---
metadata:
  title: SSI Overpayment Waiver Request
  short title: Overpayment Waiver
  revision_date: 2021-10-05
---
features:
  question help button: True
  question back button: True
  default icons: material icons
  navigation: True
  javascript: 
    - ssa.js
    - phone.js
---
modules:
  - docassemble.GithubFeedbackForm.github_issue
---
default screen parts:
  under: |
    [:comment-dots: Feedback](${ feedback_link(user_info(), github_repo="docassemble-ssioverpaymentwaiver", github_user="nonprofittechy") })
  pre: |
    % if get_config('debug'):
    `id: ${ user_info().question_id }`
    % endif
---
include:
  - ssa_634.yml
  - financial_statement.yml
  #- docassemble.gbls:basic-questions-gbls.yml
  - docassemble.ssa:ssa.yml
  - docassemble.VLPBranding:vlp_branding.yml  
---
objects:
  - recordee: Individual
  - overpaid_persons: DAList.using(object_type=Individual,there_is_another=False)
  - beneficiary: Individual
  - ssa_office: Person
  - officelist: FieldOfficeList
---
modules:
  - .ssa
  - docassemble.ALToolbox.misc
  - .fix_currency
---
features:
  css: docassemble.ALToolbox:collapse_template.css  
---
sections:
  - Getting started
  - Who is requesting a waiver?
  - Information about the overpayment
  - Financial information
  - Finishing up
---
id: interview order
mandatory: True
scan for variables: False
code: |
  nav.set_section('Getting started')
  intro_screen
  client.name.first
  

  nav.set_section('Who is requesting a waiver?')
  household_questions
  recordee.name.first
  
  
  agree_overpaid
  if not agree_overpaid:
    continue_anyway
    
  recordee.ssn
  recordee.claim_number    
    
  if not household.there_are_any:
    household.target_number = 0
    household.gathered = True

  if not recordee == client:
    relationship_to_overpaid
  else:
    client_is_rep_payee = False
  
  beneficiary.name.first
  
  if has_spouse:
    spouse.name.first
  if household.there_are_any:
    review_household_members

  if overpaid_persons.there_are_any:
    review_overpaid_persons  
  
  nav.set_section('Information about the overpayment')
  
  if only_change_monthly_due:
    explain_ssa_634
    ssa_634
    saw_signature_choice
    if not (signature_choice == 'paper'):
      client.signature    
    download_pdf
  else:
    explain_ssa_632

  payment_type
  overpayment_reason
  overpayment_explanation

  overpayment_benefits_used_for

  if informed_ssa:
    if not informed_orally:
      how_when_where
    benefits_changed_after_contact

  overpayment_why_not_at_fault  
  
  if not possess_overpayment:
    if possessed_overpayment_at_notice:
      cant_return_explanation
  else:
    pay_ssa_explanation
  
  overpayment_pay_less_reasons
  affordable_amount

  first_overpayment

  gave_cash_after_notice
  expect_change
  
  nav.set_section('Financial information')
  evaluate_if_receives_benefits # We may already know--use code to set if true
  received_ssi
  if receives_benefits:
    receives_benefits_type
    cash_amount = DAEmpty()
    vehicles = DAEmpty()
    household.jobs = DAEmpty()
    household.incomes = DAEmpty()
    client.jobs = DAEmpty()
    client.incomes =  DAEmpty()
    spouse.jobs = DAEmpty()
    spouse.incomes = DAEmpty()
    expenses = DAEmpty()
    real_estate = DAEmpty()
    assets = DAEmpty()
    assets_cannot_be_sold = DAEmpty()
    assets_cannot_be_converted = DAEmpty()
    accounts_special_purpose = DAEmpty()
    dont_need_financials_explanation
    expenses_exceed_income = DAEmpty()
    expense_other_details = DAEmpty()
  else:
    need_financials_explanation
    cash_amount
    financial_statement_questions
    if assets.there_are_any:
      accounts_special_purpose
    if non_cash_assets:
      assets_cannot_be_converted
    if vehicles.there_are_any or real_estate.there_are_any:
      assets_cannot_be_sold
    if expenses_exceed_income:
      expenses_exceed_income_explanation
    
  nav.set_section('Finishing up')
  client.address.address
  ssa_office.name.text
  
  preview_pdf
  
  run_signature_flow
  #saw_signature_choice
  #if not (signature_choice == 'paper'):
  #  if 
  #  client.signature
  
  store_variables_snapshot(data={'zip':client.address.zip,
    'state':client.address.state,
    'client_is_rep_payee':client_is_rep_payee,
    'client_goals':client_goals.true_values(),
    'agree_overpaid': agree_overpaid,
    'payment_type':payment_type.true_values(),
    'overpayment_reason': overpayment_reason,
    'possess_overpayment': possess_overpayment,
    'overpayment_pay_less_reasons': overpayment_pay_less_reasons,
    'informed_ssa':informed_ssa,
    'expect_change': expect_change.true_values(),
    'cant_pay_at_all': cant_pay_at_all,
    'informed_ssa': informed_ssa,
    'first_overpayment': first_overpayment,
    'receives_benefits': receives_benefits,
    'date':today(),
    })  
  download_pdf
  #financial_statement_download_screen
---
code: |
  # Keep in own code block so it's only evaluated once
  started_on_phone = device() and device().is_mobile
---
code: |
  # The phone/email method will only work if
  # we enforce logins
  if started_on_phone:
    saw_signature_choice = True # Don't ask how they want to sign
    client.signature
  else: 
    saw_signature_choice
    if defined('signature_choice') and signature_choice =='this device':
      client.signature
    elif defined('signature_choice') and signature_choice == 'phone':
      saw_signature_qrcode
      if defined('link_cell') or defined('link_email'):
        if defined('link_cell') and link_cell and task_not_yet_performed('send signature link'):
          send_sms(task='send signature link', to=link_cell,template=interview_link)
        if defined('link_email') and link_email:
          send_email(task='send signature link', to=link_email, template=interview_link)
        signature_wait_screen
        client.signature
        if device() and device().is_mobile:
          signature_phone_followup
      else:
        client.signature
    # Handle situation where someone uses the QR code    
    if saw_signature_choice and not defined('signature_choice'):
      client.signature
      signature_phone_followup
      signature_choice = 'phone'
  run_signature_flow = True  
---
id: signature wait screen
question: |
  % if defined('client.signature'):
  Thank you for signing
  % else:
  Add your signature
  % endif
subquestion: |
  % if defined('client.signature'):
  Click continue.
  % else:
  % if device() and device().is_mobile:
  Click continue on this screen when you're ready to sign.
  % else:
  Click continue to sign on this device. Wait here if you
  sent a link to sign to someone else. Click continue
  when your signature has been added.
  % endif
  % endif

field: signature_wait_screen
decoration: file-signature
---
id: signature phone followup
question: |
  Continue on the device you started the interview on
subquestion: |
  Thank you for signing. You can close this browser on your phone.
  Keep going on the computer you started the interview on.
field: signature_phone_followup  
---
id: signature-phone
question: |
  Sign your forms
fields:
  - note: |
      1. Open the camera app or barcode reader app on your phone.
      2. Point it at the screen.
      3. Click the link icon that appears on the camera screen.
      4. Click ${word("continue")} on your phone.
      
      <center>
      ${interview_url_as_qr()}
      </center>

    show if: 
      code: |
        device() and device().is_pc
  - Email a link instead: email_link
    datatype: yesnowide
    show if: 
      code: |
        device() and device().is_pc
  - Email address: link_email
    show if: email_link
  - Text a link instead: text_link
    datatype: yesnowide
    show if: 
      code: |
        device() and device().is_pc
  - label: Cell phone number
    field: link_cell
    show if: text_link
    default: ${showifdef('client.phone_number')}
  - note: |
      Click ${word("continue")} to add your signature.
  - note: |
      Click ${word("continue")} to add your signature.
    show if: 
      code: |
        device() and not device().is_pc
help: |
  Many smartphones will automatically find the link on this screen when you use
  the camera app. The link
  may "float" up from the screen into a small icon you can click.
  If your phone does not do this, use the text option instead.
continue button field: saw_signature_qrcode
---
code: |
  has_sellable_assets = vehicles.there_are_any or real_estate.there_are_any
---
code: |
  if recordee.name.full() == client.name.full() and payment_type['SSI']:
    we_think_recordee_is_client = True
    receives_benefits = True
    receives_benefits_type_options = 'SSI'
    receives_benefits_type = 'SSI'
    receives_ssi = True
    received_ssi = False
  else:
    we_think_recordee_is_client = False
  evaluate_if_receives_benefits = True
---
id: intro
question: |
  Social Security Overpayment Waiver or Change
subquestion: |
  This website can help you ask the Social Security administration to 
  
  1. **lower the amount that must be paid back**, or;
  1. **change the schedule of payments** for someone who is told that they
  owe the Social Security Administration money.
  
  ${ collapse_template(overpayment_waiver_help_template) }

  #### Before you get started

  Use this website if you agree that you owe the Social Security
  Administration. If you do not agree, you should file an 
  [appeal](https://secure.ssa.gov/iApplNMD/start) instead.
  
  ${ collapse_template(appeal_help_template) }
  
  Before you start, you should find:
  
  1. The notice from Social Security that says that you owe money.
  1. Information about the money that you get each month, and the money that
  people who live with you get.
  1. Find out if you get SSI, SSDI, or both.
  1. Information about how you save and spend money, such as bank statements
  and bills.
  
  This form will also ask for your Social Security number. We keep your
  information safe. Click below to learn more.
fields: 
  - Before you start you must accept the [terms of use](https://www.gbls.org/self-help/eviction/terms-of-use): intro_screen
    datatype: checkboxes
    minlength: 1
    validation messages:
      minlength: |
        You must accept the terms of use to continue.
    choices:
      - I accept the terms of use: i_accept
under: |
  _This website is not giving you legal advice. If you need legal advice, consult a lawyer._
help:
  label: |
    How do you keep my information safe?
  content: |    
    All information sent to and from this server is encrypted, using the same
    technology and strength that keeps your bank information safe.
    
    If you create an account on our system, your responses
    will be encrypted on our server at all times.
    Only someone with your password will be able to view the contents of your
    interview. 
    
    It's important to both keep your password
    secure and not to lose it, because we will not be able
    to retrieve your interview without it.
---
template: overpayment_waiver_help_template
subject: |
  More information about an overpayment waiver
content: |
  When Social Security says that you have an overpayment they are saying that you got more SSI or SSDI than you should have gotten under their rules. The reason Social Security says you have an overpayment is in the Notice of Overpayment. 
  
  If you agree with Social Security that you have an overpayment but you believe it wasn’t your fault and you can’t afford to pay it back you can ask Social Security for a Waiver. A Waiver means that you don’t have to pay back the overpayment. This interview is to help you fill out a form to ask for a Waiver of the overpayment.
---
template: appeal_help_template
subject: |
  More information about appeals
content: |
  If you do NOT agree with Social Security that you have an overpayment or if you do not understand the reasons Social Security said you have an overpayment, you can file an appeal of the overpayment. The appeal is called a Request for Reconsideration.  
  
  The deadline for filing the appeal is 60 days from the date you got your overpayment notice from Social Security. You must act quickly if you want to appeal. 
  
  If you got an overpayment notice after going back to work while you were on SSI or SSDI, you may be able to get legal advice from the Disability Law Center. Call them at ${tel("617-723-8455") } or ${ tel("1-800-872-9992") }. They may be able to help you decide if you should file an appeal or a waiver. 
  
  You can [start your appeal online](https://secure.ssa.gov/iApplNMD/start) or by filling out the [Request for Reconsideration form](https://www.ssa.gov/forms/ssa-561-u2.pdf) and sending it to your [local Social Security office](https://www.ssa.gov/open/data/FO-RS-Address-Open-Close-Time-App-Devs.html).

  Learn more:
  
  * [https://www.illinoislegalaid.org/legal-information/ssi-and-ssdi-overpayments-and-appeals](https://www.illinoislegalaid.org/legal-information/ssi-and-ssdi-overpayments-and-appeals)
  * [https://www.masslegalservices.org/content/ssi-overpayment-booklet](https://www.masslegalservices.org/content/ssi-overpayment-booklet)
  * [https://www.masslegalservices.org/content/ssdi-overpayment-booklet](https://www.masslegalservices.org/content/ssdi-overpayment-booklet)

---
id: who is overpaid
question: |
  Who got too much money from Social Security?
subquestion:
  Whose account is the overpayment on?
  Look at the letter about the overpayment that you got from Social Security.
  Look for a Social Security or Claim Number on the letter. Write down the name 
  of the person who has that
  Social Security number.
fields:
  - no label: recordee
    datatype: object_radio
    disable others: True
    default: client
    object labeler: |
      lambda y: "Me (" + str(y) + ")"
    none of the above: |
      Someone else
    choices: |
      who_overpaid_options
  - First name: recordee.name.first
  - Middle name: recordee.name.middle
    required: False
  - Last name: recordee.name.last
  #- Social Security Number: recordee.ssn
  #  datatype: ssn
  #  validate: is_valid_ssn
  #- Claim number: recordee.claim_number
  #  required: False
---
id: representation to overpaid
question: |
  What is your relationship to ${recordee}?
subquestion:
  You are ${recordee.possessive("___")}
fields:
  - no label: relationship_to_overpaid
    #input type: checkboxes
    choices:
      - parent
      - spouse
      - representative payee
      - legal guardian
      - other
  - Other: other_relationship
    input type: area
    js show if: |
      val("relationship_to_overpaid") === "other"
---
code: |
  if recordee == client:
    client_is_rep_payee = False
---
code: |
  if not isinstance(expenses, DAEmpty): 
    expenses_exceed_income = expenses.total() > (client.incomes.total() + spouse.incomes.total() + household.incomes.total())
  else:
    expenses_exceed_income = False  
---
id: agree overpaid
question: |
  Do you agree that ${recordee} got too much money from Social Security?
subquestion: |
  Choose the answer that best matches what you understand about what happened.
  If you agree that ${recordee} was overpaid, you are _not_ agreeing that you
  need to pay the Social Security Administration back.
field: agree_overpaid
choices:
  - I disagree that ${recordee} got too much money. I think ${recordee} was paid the right amount: False
  - I agree ${recordee} was paid too much, even if it was an accident.: True
---
id: objective
question: |
  What are you asking the Social Security Administration to do?
fields:
  - no label: client_goals
    # required: False
    datatype: checkboxes
    choices:
      - "**Reduce** the amount I pay back each month.": change_payment
      - "**Reduce** or **waive** the total amount I need to pay.": waiver_payment
    none of the above: |
      I don't know
---
code: |
  only_change_monthly_due = len(client_goals.true_values()) == 1 and client_goals["change_payment"]
---
comment: |
  Not sure we will leave this in--somewhat in the nature
  of debugging for now. But could be useful for transparency.
id: explain ssa 634
question: |
  We'll complete form SSA-634 for you
subquestion: |
  You said you only are asking the Social Security Administration
  to change the amount you pay each month. That means we only need
  to complete form SSA-634.
  
  Form SSA-634 is a little simpler and asks fewer questions.
  
  Below is what the first page of form SSA-634 looks like. 
  
  ${ SSA_634.show(width='28em') }
    
continue button field: explain_ssa_634  
---
id: explain ssa 632
question: |
  We'll complete form SSA-632 for you
subquestion: |
  % if not len(client_goals.true_values()):
  You said you aren't sure yet what you want the Social Security Administration
  to do. That means we'll need to complete form SSA-632.
  % else:
  You said you would like the Social Security Administration to change the
  total amount you will pay back. That means we'll complete form SSA-632.
  % endif
  
  Below is what the first page of form SSA-632 looks like.
  
  ${ SSA_632.show(width='28em') }
continue button field: explain_ssa_632
---
objects:
  - SSA_634: DAStaticFile.using(filename='SSA_634.png', alt_text='SSA-634')
  - SSA_632: DAStaticFile.using(filename='SSA_632.png', alt_text='SSA-632')
---
id: exit dont agree overpaid
decoration: hand-paper
question: |
  This may not be the right form for you.
subquestion: |
  This form is used when you want the Social Security Administration to waive or reduce the amount you owe them.
  
  If you don't agree with the Social Security Administration that an overpayment happened, you may want to appeal the overpayment instead. It's a good idea to talk to a lawyer. For help finding legal aid, visit the [Legal Services Corporation](https://www.lsc.gov/what-legal-aid/find-legal-aid).
  
  If you received the letter from the Social Security Administration notifying you of the overpayment more than 65 days ago, it is too late for you to file an appeal. If it is too late for you to file an appeal and you don’t agree that an overpayment happened, you should still proceed by selecting "Keep going" to request the Social Security Administration waive or reduce the amount you owe them.
buttons:
  - Keep going:
      code: |
        continue_anyway = True  
  - Restart: restart
  - Exit: exit
---
id: is rep payee
question: |
  Are you ${recordee}'s representative payee?
subquestion: |
  You said the overpayment was on ${recordee}'s account.
  At the time the Social Security Admininistration says you 
  were overpaid, were you a  
  representative payee for ${recordee}?
yesno: client_is_rep_payee
---
id: overpayment info
question: |
  Tell us about ${recordee}'s overpayment
fields:
  - Did you live with ${recordee} when the overpayment happened?: someone_else_lived_with_user
    datatype: yesnoradio
  - Did you receive any of the overpaid money?:   someone_else_user_received_benefits
    datatype: yesnoradio
---
id: how benefits used
question: |
  What did you spend the overpaid benefits on?
fields:
  - no label: overpayment_benefits_used_for
    datatype: area
    maxlength: 86
---
id: beneficiary info
question: |
  Who is the beneficiary?
subquestion: |
  Sometimes the person who uses the benefits is different than the person
  who earned them. For example, a spouse or dependent may get the benefits
  earned by someone who worked who retired or became disabled.
  If ${recordee} both earned and uses the benefits, just select their name here.
fields:
  - Somebody already mentioned: beneficiary
    datatype: object_radio
    default: client
    disable others: True
    choices: |
      everyone
    none of the above: Someone else      
    object labeler: |
      lambda y: str(y) if y != client else 'Me (' + str(y) + ')'
  - First name: beneficiary.name.first
  - Last name: beneficiary.name.last
  - Address: beneficiary.address.address
    address autocomplete: True
  - Unit or Apt: beneficiary.address.unit
    required: False
  - City: beneficiary.address.city
  - State: beneficiary.address.state
    code: |
      states_list()
  - Zip code: beneficiary.address.zip
    required: False
  - County: beneficiary.address.county
    required: False      
---
id: additional users
question: |
  Is anyone else using this form with you?
subquestion: |
  If the Social Security Administration says that more than one person has to
  pay them back, they can use this form with you.
  
  If you think you and the other person may disagree about whose fault the
  overpayment was, it may be safest for you each to use your own forms.
  
  Do you want to list someone else on this form with you who will also be asking the
  Social Security Administration to waive the overpayment?
yesno: overpaid_persons.there_are_any
---
id: additional user info
question: |
  Who is the ${ordinal(i)} person who will use the form with you?
fields:
  - Somebody already mentioned: overpaid_persons[i]
    datatype: object
    disable others: True
    choices: |
      everyone_but_me
  - First name: overpaid_persons[i].name.first
  - Middle name: overpaid_persons[i].name.middle
    required: False
  - Last name: overpaid_persons[i].name.last
  - Social Security Number: overpaid_persons[i].ssn
    validate: is_valid_ssn
    datatype: ssn

---
id: social security number
generic object: Individual
question: |
  Social Security Number for ${x}
subquestion: |
  What is ${x}'s Social Security Number?
fields:
  - SSN: x.ssn
    validate: is_valid_ssn
    datatype: ssn  
under: |
  {Why} do we need this?
terms:
  - Why: |
      The Social Security Administration needs this number in order to 
      apply this overpayment waiver request to the right account.
---
id: claim number
generic object: Individual
question: |
  Claim number
subquestion: |
  If ${x} has a claim number that is different from their Social Security
  number, enter it below.
fields:
  - Claim number: x.claim_number
    required: False
---
id: review overpaid persons 
question: |
  Overpaid Persons
subquestion: |
  So far you have told us about ${overpaid_persons.number()} people who will
  be listed on this form with you. You can add another person, or click
  continue to go to the next question.
  ${ overpaid_persons.table }
  ${overpaid_persons.add_action()}
field: review_overpaid_persons
---
table: overpaid_persons.table
rows: overpaid_persons
columns:
  - Name: |
      row_item
  - Social Security Number: |
      row_item.ssn
edit:
  - row_item.name.first
  - row_item.ssn
---
id: overpaid person info
question: |
  Who is the ${ordinal(i)} overpaid person?  
fields:
  - Social Security Number: overpaid_persons[i].ssn
    validate: is_valid_ssn
    datatype: ssn
---
id: have overpaid money
question: |
  Do you currently have any of the money you were overpaid? 
fields:
  - no label: possess_overpayment
    datatype: yesnoradio
  - How much do you still have?: possess_overpayment_amount
    show if: possess_overpayment
    datatype: currency
    min: 1
    step: 1
---
id: pay ssa explanation
question: |
  You will need to pay the Social Security Administration back
subquestion: |
  The Social Security administration will ask you to pay back the ${currency(possess_overpayment_amount, decimals=False)}
  that you said you still have from the overpayment. If that is less than the full 
  amount of the overpayment you may still need to pay back more, but you can ask for a 
  payment plan that works for you.
field: pay_ssa_explanation
---
id: had overpaid money
question: |
  What happened to the overpaid checks or money?
subquestion: |
  You said you no longer have any of the money you were overpaid.
fields: 
  - When you got the overpayment notice, did you have any of the money you were overpaid?: possessed_overpayment_at_notice
    datatype: yesnoradio
  - How much did you have then?: possessed_overpayment_at_notice_amount
    datatype: currency
    step: 1
    show if: possessed_overpayment_at_notice
    
---
id: receives benefits
question: |
  Are you currently receiving any needs-based cash benefits?
subquestion: |
  Answer yes if you personally receive cash welfare benefits, SSI, or a state cash 
  benefit that is based on your need.
yesno: receives_benefits  
help: |
  If you are receiving SSI or another benefit based on your need, you do not need
  to give the Social Security Administration as much information about your finances.
---
id: benefits kind
question: |
  What kind of cash benefits are you receiving?
fields: 
  - no label: receives_benefits_type_options
    datatype: checkboxes
    choices:
      - SSI: SSI
      - EAEDC: EAEDC
      - TAFDC (Temporary Aid to Families with Dependent Children): TAFDC
      - Other: other
  - Name of benefits program: receives_benefits_other
    show if: receives_benefits_type_options['other']
  - What is the account or claim number for your benefits?: receives_benefits_claim_number
    show if: receives_benefits_type_options['other']

---
code: |
  if receives_benefits_type_options['SSI'] or receives_benefits_type_options['TAFDC'] or receives_benefits_type_options['EAEDC']:
    receives_benefits_type = receives_benefits_type_options.true_values()
  else:
    receives_benefits_type = receives_benefits_other
---
id: dont need financial statement explanation
question: |
  You don't need to give us your financial information
subquestion: |
  Because you are receiving ${receives_benefits_type}, you don't need to answer the
  financial questions on this form. We'll finish asking for your contact information
  and signature on the next few pages.
field: dont_need_financials_explanation
---
id: do need financial statement explanation
question: |
  We will need to collect your financial information
subquestion: |
  In the next section, we will need to ask detailed information about how you,
  your spouse, and any household members earn money, as well as your household
  expenses. You will need to list any money you or a household member earns from 
  any source, including things like odd jobs, interest on bank accounts, and informal 
  payments for household expenses.
  
  Take a minute to make sure you have any pay stubs, tax returns or receipts for
  self-employment income, bank statements, and any monthly bills you pay.
  
  % if user_logged_in():
  If you don't have information about all your expenses or if you need a break, your work has been saved and you can come back later to finish the interview.
  % else:
  If you don't have information about all your expenses or if you need a break, you can save your work and come back later to finish the interview by creating an account.
  
  ${ action_button_html(url_of('register'), label="Create an account") }
  
  % endif
field: need_financials_explanation  
---
id: cash on hand
question: |
  Cash on hand
fields:
  - How much money do you, your spouse, or anybody who depends on you have available as cash on hand?: cash_amount
    datatype: currency   
---
id: ssa payment type
question: |
  What kind of Social Security payments does ${recordee} receive?
fields:
  - no label: payment_type
    datatype: checkboxes
    choices:
      - Supplemental Security Income (SSI): SSI
      - Social Security Disability (SSDI): other
      - Retirement benefits: other
    none of the above: |
      ${recordee} no longer receives any money from Social Security
---
id: actions after overpayment notice
question: |
  What happened after you got the overpayment notice from Social Security?
subquestion: |
  Think about what happened after Social Security told you that ${recordee} got
  too much money.
fields:  
  - Did you lend or give away any property or cash after the notice of overpayment?: gave_cash_after_notice
    datatype: yesnoradio
  - Describe who got the property or cash, what it was and its value: gave_cash_after_notice_explanation
    datatype: area
    maxlength: 170
    show if: gave_cash_after_notice
  - Did you get or sell any property or get any cash, (other than money you got from working), after the notice of overpayment?: received_cash_after_notice
    datatype: yesnoradio
  - Describe the property and sale price, or amount of cash received: received_cash_after_notice_explanation
    datatype: area
    maxlength: 170
    show if: received_cash_after_notice
---
id: why cant return overpayment
question: |
  Why can't you return the overpayment any more?
subquestion: |
  You said that when you got the notice, you still had 
  ${ currency(possessed_overpayment_at_notice_amount, decimals=False) } from the overpayment.
  Using your own words, explain to the Social Security Administration 
  why you do not think you should have to return the ${ currency(possessed_overpayment_at_notice_amount, decimals=False) }
  anymore.
fields:
  - no label: cant_return_explanation
    datatype: area
    maxlength: 273
---
id: expenses higher than income
question: |
  Your expenses are higher than your income
subquestion: |
  From the information you gave us, your monthly expenses
  are higher than your income. Explain how you are paying your bills
  below.
fields:
  - no label: expenses_exceed_income_explanation
    datatype: area
    maxlength: 290
---
id: ability to pay
question: |
  Can you pay back the full amount?
subquestion: |
  Check any of the below that apply
fields:
  - no label: overpayment_pay_less_reasons
    datatype: checkboxes
    choices:
      - I cannot afford to pay back the money
      - The overpayment was not my fault
      - Requiring me to pay back the overpayment is unfair
    none of the above: None of the above. I can pay **everything** back      
---
code: |
  overpayment_not_my_fault = overpayment_pay_less_reasons['The overpayment was not my fault']
  overpayment_cant_afford = overpayment_pay_less_reasons['The overpayment was not my fault']
---
id: amount can pay
question: |
  How much can you afford to pay back each month?
  
fields:
  - I cannot pay anything at all: cant_pay_at_all
    datatype: yesno
  - '': affordable_amount
    datatype: currency
    hide if: cant_pay_at_all
validation code: |
  if cant_pay_at_all:
    affordable_amount = 0
---
id: ssi payment status
question: |
  SSI Payments
fields:
  - Were you receiving SSI payments in the past?: received_ssi
    datatype: yesnoradio
  - Are you receiving SSI payments right now?: receives_ssi
    datatype: yesnoradio
---
id: overpayment reason
question: |
  What is the reason for the overpayment?
subquestion: |
  Look at the letter the Social Security Administration sent you.
  What reason is the best match for why the Social Security Administration
  says you were overpaid?
fields:
  - no label: overpayment_reason
    input type: radio
    code: |
      overpayment_reason_choices
---
if: |
  payment_type['other'] and not payment_type['SSI']
variable name: overpayment_reason_choices
data:
  - out_of_country: ${recordee} went out of the country for more than 30 days
  - something_else: Something else
  - dont_know: I don't know
---
if: |
  payment_type['SSI']
variable name: overpayment_reason_choices
data:
  - money_in_bank: ${recordee} had too much money in a bank account
  - worked_many_hours: ${recordee} went back to work and made too much money
  - out_of_country: ${recordee} went out of the country for more than 30 days
  - something_else: Something else
  - dont_know: I don't know
---
id: overpayment explanation
question: |
  Why did the overpayment happen?
fields:
  - Explain how the overpayment happened.: overpayment_explanation
    datatype: area
    maxlength: 435
---
depends on:
  - overpayment_reason
code: |
  overpayment_reason_plain_text = next(filter(lambda reason: next(iter(reason),'') == overpayment_reason, overpayment_reason_choices),{}).get(overpayment_reason)
---
id: overpayment fault
question: |
  Why was the overpayment not your fault?
subquestion: |
  % if overpayment_reason == 'dont_know' or overpayment_reason == 'something_else':
  Explain why the overpayment wasn't your fault.
  Answer "I don't know" if that is the best answer.
  You can type a total of 460 characters in the spaces provided.
  % else:
  You said that the Social Security Administration believes the overpayment happened because ${overpayment_reason_plain_text}.
  Explain why the overpayment wasn't your fault. 
  Answer "I don't know" if that is the best answer.
  You can type a total of 460 characters in the spaces provided.
  % endif
fields:
  - Why was the overpayment not your fault?: overpayment_why_not_at_fault
    datatype: area
  - Why is it not your fault that you accepted the overpayment?: overpayment_why_accepted
    datatype: area
  - Why did you think you had a right to the money?: overpayment_why_had_right
    datatype: area
validation code: |
  if len(overpayment_why_not_at_fault) + len(overpayment_why_accepted) + len(overpayment_why_had_right) > 460: validation_error("It's too long.")
---
id: ssa contact
question: |
  Contact with Social Security Administration
subquestion: |
  % if overpayment_reason == 'dont_know' or overpayment_reason == 'something_else':

  % else:
  You said that the reason for the overpayment was that ${overpayment_reason_plain_text}.
  % endif
fields:
  - label: |
      % if overpayment_reason == 'dont_know' or overpayment_reason == 'something_else':
      Did you tell the Social Security Administration about the change or event that made you overpaid?
      % else:
      Did you tell the Social Security Administration that ${overpayment_reason_plain_text}?
      % endif
    field: informed_ssa
    datatype: yesnoradio
  - Why not?: did_not_inform_ssa_explanation
    datatype: area
    maxlength: 285
    show if:
      variable: informed_ssa
      is: False
  - label: |
      % if overpayment_reason == 'dont_know' or overpayment_reason == 'something_else':
      Did you talk to someone (by phone or in person) about the change or event that made you overpaid?
      % else:
      Did you talk to someone (by phone or in person) about the fact that ${overpayment_reason_plain_text}?
      % endif
    field: informed_orally
    datatype: yesnoradio
    show if: informed_ssa
  - Who did you talk to?: who_spokewith
    maxlength: 44
    show if: informed_orally
  - What did you say?: informed_what_said 
    datatype: area
    maxlength: 300
    show if: informed_orally
---
id: ssa contact how
question: |
  How did you talk to the Social Security Administration?
subquestion: |
  You said that you told Social Security about the overpayment, but it wasn't by phone or in person.
fields:
  - Explain how, when and where you told the Social Security Administration that you were being overpaid.: how_when_where
    datatype: area
    maxlength: 344
---
id: ssa contact followup
question: |
  Follow-up
subquestion: |
  % if overpayment_reason == 'dont_know' or overpayment_reason == 'something_else':
  You said that you contacted the Social Security Administration to let them know that you were overpaid.
  % else:
  You said that you contacted the Social Security Administration to let them know that ${overpayment_reason_plain_text}.
  % endif
fields:
  - label: |
      % if overpayment_reason == 'dont_know' or overpayment_reason == 'something_else':
      After you reported the overpayment, did the Social Security Administration change your benefits amount?
      % else:
      After you reported that ${overpayment_reason_plain_text}, did the Social Security Administration change your benefits amount?
      % endif
    field: benefits_changed_after_contact
    datatype: yesnoradio
  - Did you try to let the Social Security Administration know about the overpayment more than once?: benefits_did_not_change_followed_up
    datatype: yesnoradio
    show if:  
      variable: benefits_changed_after_contact
      is: False
---
id: past overpayments
question: |
  Past overpayments
fields:
  - Is this the first time you have been overpaid?: first_overpayment
    datatype: yesnoradio
  - What Social Security Number were you overpaid on before?: past_overpayment_ssn
    validate: is_valid_ssn
    datatype: ssn
    show if:
      variable: first_overpayment
      is: False
  - Why were you overpaid in the past?: past_overpayment_explanation
    datatype: area
    maxlength: 125
    show if:
      variable: first_overpayment
      is: False
  - If the reason is similar to the reason you were overpaid this time, explain what you did to prevent it happening again.: past_overpayment_similar_explanation
    datatype: area
    maxlength: 125
    show if:
      variable: first_overpayment
      is: False 
---
id: expected financial changes
comment: |
  Financial expectation and funds availability
question: |
  Changes to your financial situation
subquestion: |
  Please think about your financial situation and any changes, whether
  for the better or worse, that you expect in the next 6 months.
fields:
  - In the next 6 months, I expect I or a household member: expect_change
    datatype: checkboxes
    choices:
      - Will receive a large tax refund
      - Will have a large bill repaid to me
      - Will receive a pay raise
      - Will receive a pay cut
      - Will pay a major bill (such as house repairs): Will pay a major bill
      - Other financial change for the better
      - Other financial change for the worse
  - Explain: expect_change_explanation
    datatype: area
    maxlength: 174
    js show if: |
      val("expect_change['Will receive a large tax refund']") || val("expect_change['Will receive a pay raise']") || val("expect_change['Will have a large bill repaid to me']") || val("expect_change['Will receive a pay raise']") || val("expect_change['Will receive a pay cut']") || val("expect_change['Will pay a major bill']") || val("expect_change['Other financial change for the better']") || val("expect_change['Other financial change for the worse']")
---
code: |
  if assets.there_are_any:
    cash_assets = [asset for asset in assets if asset.type in ['savings','checking']]
    #cash_assets = []
    non_cash_assets = [asset for asset in assets.elements if asset.type not in ['savings','checking']]
  else:
    cash_assets = []
    non_cash_assets = []
  fixed_assets = vehicles.elements + real_estate.elements
---
id: funds being saved
question: |
  Are any funds being saved for a special purpose?
subquestion: |
  You said that you or a household member have the following
  accounts that have cash on hand.
  
  Check any funds that are being saved for a special purpose.
fields:
  - no label: accounts_special_purpose
    datatype: object_checkboxes
    choices: cash_assets
    object labeler: |
      lambda y: y.type + ':' +' '  + currency(y.balance, decimals=False)
  - Explain what the special purpose is: accounts_special_purpose_explanation
    datatype: area        
    required: False
    maxlength: 174
---
id: convertable noncash assets
question: |
  Are there any assets with a balance or value that CANNOT be converted to cash?
subquestion: |
  You said that you or a household member have the following assets
  that have a "balance or value".

  Check any assets below that CANNOT be converted to cash.
fields:
  - no label: assets_cannot_be_converted
    datatype: object_checkboxes
    choices: non_cash_assets
    object labeler: |
      lambda y: y.type + ':' + ' ' + currency(y.balance, decimals=False)
  - Explain why the assets CANNOT be converted to cash: assets_cannot_be_converted_explanation
    datatype: area
    required: False
    maxlength: 174
---
id: convertable cash assets
question: |
  Are there any assets that do not have a balance or value that CANNOT be sold or
  otherwise converted to cash?
subquestion: |
  You said that you or a household member have the following
  vehicles and real estate, other than the family car or house.

  Check any assets below that CANNOT be sold or otherwise converted
  to cash.
fields:
  - no label: assets_cannot_be_sold
    datatype: object_checkboxes
    choices: fixed_assets
    object labeler: |
      lambda y: (y.year_make_model()) if hasattr(y,'make') else y.description
  - Explain why the vehicle or property CANNOT be sold: assets_cannot_be_sold_explanation
    datatype: area
    required: False
    maxlength: 174
---
id: contact information
generic object: Individual
question: |
  ${x}'s Contact Information
fields:
  - Home or cell phone number: x.phone_number
  - Work phone number: x.phone_work
    required: False
  - Address: x.address.address
    address autocomplete: True
  - Unit or Apt: x.address.unit
    required: False
  - City: x.address.city
  - State: x.address.state
    code: |
      states_list()
  - Zip code: x.address.zip
    required: False
---
id: which office
question: |
  What Social Security office do you want to send the letter to?
subquestion: |
  % if found_offices:
  We have found the following offices that are close to your address.
  
  ${map_of([office for office in officelist])}
  % else:
  You can use the [Office locator](https://secure.ssa.gov/ICON/main.jsp) to find
  a Social Security Office near you.
  % endif
fields:
  - Social Security Office: ssa_office
    datatype: object_radio
    # input type: radio
    choices: officelist
    none of the above: True
    disable others: True
    object labeler: |
      lambda y: (y.address.on_one_line())
  - note: |
      Choose an office above, or use the [Office locator](https://secure.ssa.gov/ICON/main.jsp)
    show if: found_offices
  - Office name: ssa_office.name.text
  - Address: ssa_office.address.address
  - Suite: ssa_office.address.unit
    required: False
  - City: ssa_office.address.city
  - State: ssa_office.address.state
    code: |
      states_list()
---
code: |
  officelist.load_offices(client.address)
  officelist.gathered = True
---
code: |
  found_offices = officelist.number() > 0
---
id: signature method
decoration: file-signature
question: |
  Sign your forms
subquestion: |
  We are almost ready to print your forms. You will need to sign them before
  delivering them. We recommend you sign electronically now, before you print. 
  You can sign using your computer mouse, or sign on your phone with your finger.
field: signature_choice
buttons:  
  - Sign on a mobile phone: phone
    image: mobile-alt
  - Sign on this computer: this device
    image: desktop
  - Sign after I print: paper
    image: print
script: |
  <script>
    $(document).on('daPageLoad', function(){
      $(".da-field-buttons > div > .btn-da-custom").last().after("<br>")
      $(".da-field-buttons > div > .btn-da-custom").first().before("<br>")
    });
  </script>
continue button field: saw_signature_choice  
---
id: sign on phone
question: Sign on your phone
subquestion: |
  % if device().is_pc:
  Click continue on this screen once you have finished signing on your phone.
  % else:
  Click continue on this screen when you're ready to sign.
  % endif
  
field: signature_wait_screen  
---
template: interview_link
content: |
  You are being asked to sign a Request for SSI Overpayment Waiver form.
  Click the link below to add your signature on your phone.
  
  ${interview_url()}
---
id: signature
question: Sign below
subquestion: |
signature: client.signature
under: |
  ${ client }
---
code: |
  client_support = client.incomes.total(type='other') > 0 if not isinstance(client.incomes, DAEmpty) else []
  spouse_support = spouse.incomes.total(type='other') > 0 if not isinstance(spouse.incomes, DAEmpty) else []
  household_support = household.incomes.total(type='other') > 0 if not isinstance(household.incomes, DAEmpty) else []
    
  receives_support = client_support or spouse_support or household_support
  all_incomes = client.incomes + spouse.incomes + household.incomes
  
  if receives_support:
    support_sources = [income.name for income in all_incomes if income.type == 'other support']
  else:
    support_sources = []
    
---
code: |
  client_pensions = client.incomes.matches('pension')
  spouse_pensions = spouse.incomes.matches('pension')
  household_pensions = household.incomes.matches('pension')
---
code: |
  savings = assets.matches('savings')
---
code: |
  grand_total = (client.incomes.total(period_to_use=12) +
                  spouse.incomes.total(period_to_use=12) + 
                  household.incomes.total(period_to_use=12) +
                  client.jobs.net_total(period_to_use=12) +
                  spouse.jobs.net_total(period_to_use=12) +
                  household.jobs.net_total(period_to_use=12) +
                  assets.total(period_to_use=12) 
                  )

  monthly_expenses = expenses.total()

  adjusted_expenses = monthly_expenses + 25 # See Question 20C
---
code: |
  if len(cash_assets) > 0:
    cash_kept_special_purpose = len(accounts_special_purpose) > 0
    cash_special_purpose_no_money_on_hand = False
  else:
    cash_kept_special_purpose = False
    cash_special_purpose_no_money_on_hand = True
---
code: |
  room_and_board_explanation = comma_and_list([item.room_and_board_explanation for item in all_incomes if item.type == "room and board"])     
---
code: |
  asset_other_description = comma_and_list([item.other_type for item in assets if item.type == "other"])
---
code: |
  expense_support_details = comma_and_list([item.support_explanation for item in expenses if item.type == "support"])
---
id: preview pdf
continue button field: preview_pdf
question: |
  Review your form before you sign it
subquestion: |
  Here is a preview of the form you'll sign on the next page. 
  
  ${ ssa_634_template if only_change_monthly_due else ssa_632_template }
   
  Remember to come back to this window to continue and sign your form.
---
id: download pdf
event: download_pdf
question: |
  Your document is ready
subquestion: |
  1. Download and print 2 copies of the "Request For Waiver Of Overpayment Recovery Or Change In Repayment Rate" document below.
  1. Keep one copy for your own records.
  2. Deliver one copy to your local Social Security Administration
  office.
attachment code: |
  ssa_634_template if only_change_monthly_due else ssa_632_template
allow emailing: False
buttons:
  - Exit: exit
    url: https://www.ssa.gov/ssi/text-overpay-ussi.htm
  - Restart: restart
---
need: 
  - grand_total
  - cash_kept_special_purpose
  - has_sellable_assets
attachment:
  - name: SSA-632 Request For Waiver Of Overpayment Recovery Or Change In Repayment Rate
    filename: SSA-632
    skip undefined: True
    variable name: ssa_632_template
    pdf template file: ssa-632.pdf
    # checkbox export value: "On"
    editable: False
    fields:
      - "record_owner": ${recordee}
      - "record_ssn": ${recordee.ssn}
      - "requestor_1": |
          ${overpaid_persons.item(0)} ${overpaid_persons.item(0).ssn}
      - "requestor_2": |
          ${overpaid_persons.item(1)} ${overpaid_persons.item(1).ssn}
      - "requestor_3": |
          ${overpaid_persons.item(2)} ${overpaid_persons.item(2).ssn}
      - "requestor_4": |
          ${overpaid_persons.item(3)} ${overpaid_persons.item(3).ssn}
      - "requestor_5": |
          ${overpaid_persons.item(4)} ${overpaid_persons.item(4).ssn }     
      - "requestor_6": |
          ${overpaid_persons.item(5)} ${overpaid_persons.item(5).ssn}
      - "requestor_7": |
          ${overpaid_persons.item(6)} ${overpaid_persons.item(6).ssn}
      - "requestor_8": |
          ${overpaid_persons.item(7)} ${overpaid_persons.item(7).ssn}      
      - "overpayment_not_my_fault": ${yesno(overpayment_pay_less_reasons.any_true())}
      - "overpayment_cant_afford_full_benefit": ${yesno(overpayment_cant_afford)}
      - "overpayment_affordable_amount": ${thousands(affordable_amount) if overpayment_cant_afford and payment_type.any_true() else ''}
      - "overpayment_dont_receive_ssi": ${yesno(received_ssi)}
      - "overpayment_dont_receive_ssi_affordable_amount": ${thousands(affordable_amount) if received_ssi else ''}
      - "overpayment_receive_ssi": ${yesno(receives_ssi)}
      - "overpayment_receive_ssi_affordable_amount": ${thousands(affordable_amount) if receives_ssi else ''}
      - "rep_received_benefits_no": ${noyes(client_is_rep_payee)}
      - "rep_received_benefits_yes": ${yesno(client_is_rep_payee)}
      - "beneficiary_name": ${beneficiary.name.full() + ' ' + beneficiary.address.block() if client_is_rep_payee else ''}
      - "benefits_used_for": ${ overpayment_benefits_used_for if client_is_rep_payee else ''}
      - "someone_else_lived_with_user_yes": ${yesno(someone_else_lived_with_user) if not recordee == client else ''} 
      - "someone_else_lived_with_user_no": ${noyes(someone_else_lived_with_user) if not recordee == client else ''} 
      - "someone_else_user_received_benefits_no": ${noyes(someone_else_user_received_benefits) if not recordee == client else ''}
      - "someone_else_user_received_benefits_yes": ${yesno(someone_else_user_received_benefits) if not recordee == client else ''}
      - "someone_else_overpayment_explanation": ${ overpayment_explanation if not recordee == client else ''}
      - "why_thought_entitled": ${ fix_punctuation(overpayment_why_not_at_fault) + ' ' + fix_punctuation(overpayment_why_accepted) + ' ' + fix_punctuation(overpayment_why_had_right) }
      - "told_ssa_yes": ${yesno(informed_ssa)}
      - "told_ssa_no": ${noyes(informed_ssa)}
      - "why_didnt_tell_ssa": ${ did_not_inform_ssa_explanation if not informed_ssa else '' }
      - "told_ssa_how": |
            % if informed_ssa and informed_orally: 
            ${ who_spokewith + informed_what_said }
            % elif informed_ssa and not informed_orally:
            ${ how_when_where }
            % endif
      - "contacted_ssa_again_yes": |
            % if informed_ssa and not benefits_changed_after_contact:
            ${ benefits_did_not_change_followed_up }
            % endif
      - "contacted_ssa_again_no": |
            % if informed_ssa and not benefits_changed_after_contact:
            ${ not benefits_did_not_change_followed_up }
            % endif
      - "overpaid_before_yes": ${noyes(first_overpayment)}
      - "overpaid_before_no": ${yesno(first_overpayment)}
      - "overpaid_before_ssn": ${past_overpayment_ssn if not first_overpayment else ''}
      - "overpaid_before_steps_to_prevent": ${ fix_punctuation(past_overpayment_explanation) + ' ' + fix_punctuation(past_overpayment_similar_explanation) if not first_overpayment else ''}
      - "possess_money_yes": ${yesno(possess_overpayment)}
      - "possess_money_amount": ${currency(possess_overpayment_amount, decimals=False) if possess_overpayment else ''}
      - "possess_money_no": ${noyes(possess_overpayment)}
      - "possessed_money_yes": ${yesno(possessed_overpayment_at_notice)}
      - "possessed_money_amount": ${currency(possessed_overpayment_at_notice_amount, decimals=False) if possessed_overpayment_at_notice else ''}
      - "possessed_money_no": ${noyes(possessed_overpayment_at_notice)}
      - "why_can_keep": ${cant_return_explanation if not possess_overpayment and possessed_overpayment_at_notice else ""}
      - "gave_away_yes": ${yesno(gave_cash_after_notice)}
      - "gave_away_no": ${noyes(gave_cash_after_notice)}
      - "gave_away_details": ${gave_cash_after_notice_explanation if gave_cash_after_notice else ''}
      - "sold_yes": ${yesno(received_cash_after_notice)}
      - "sold_no": ${noyes(received_cash_after_notice)}
      - "sold_details": ${received_cash_after_notice_explanation if received_cash_after_notice else ''}
      - "receiving_benefits_yes": ${yesno(receives_ssi)}
      - "receiving_benefits_no": ${noyes( receives_ssi)}
      - "receiving_benefits_name": ${receives_benefits_type if receives_benefits  else ''}
      - "receiving_benefits_claim_number": ${receives_benefits_claim_number if receives_benefits.any_true() and not receives_ssi else ''}
      - "dependent_1": ${household.item(0)}
      - "dependent_1_age": ${household.item(0).age}
      - "dependent_1_relationship": ${household.item(0).relationship}
      - "dependent_2": ${household.item(1)}
      - "dependent_2_age": ${household.item(1).age}
      - "dependent_2_relationship": ${household.item(1).relationship}
      - "dependent_3": ${household.item(2)}
      - "dependent_3_age": ${household.item(2).age}
      - "dependent_3_relationship": ${household.item(2).relationship}
      - "dependent_4": ${household.item(3)}
      - "dependent_4_age": ${household.item(3).age}
      - "dependent_4_relationship": ${household.item(3).relationship}
      - "cash_amount": ${currency(cash_amount, decimals=False)}
      - "savings_owner_1": ${assets.item(0).owner}
      - "savings_amount_1": ${thousands(assets.matches('savings').item(0).balance)}
      - "savings_monthly_1": ${thousands(assets.matches('savings').item(0).amount(period_to_use=12))}
      - "savings_explanation_1": ${assets.matches('savings').item(0).no_income_explanation if assets.matches('savings').item(0).value == 0 else ''}
      - "savings_owner_2": ${assets.matches('savings').item(1).owner}
      - "savings_amount_2": ${thousands(assets.matches('savings').item(1).balance)}
      - "savings_monthly_2": ${thousands(assets.matches('savings').item(1).amount(period_to_use=12))}
      - "savings_explanation_2": ${assets.matches('savings').item(1).no_income_explanation if assets.matches('savings').item(1).value == 0 else ''}
      - "cd_explanation": ${assets.matches('cd').item(0).no_income_explanation if assets.matches('cd').item(0).value == 0 else ''}
      - "cd_owner": ${comma_and_list(assets.owners(type='cd'))}
      - "cd_amount": ${thousands(assets.balance_total(type='cd'))}
      - "cd_monthly": ${thousands(assets.total(type='savings',period_to_use=12))}
      - "ira_owner": ${comma_and_list(assets.owners(type='ira'))}
      - "ira_amount": ${thousands(assets.balance_total(type='ira'))}
      - "ira_monthly": ${thousands(assets.total(type='ira',period_to_use=12))}
      - "ira_explanation": ${assets.matches('ira').item(0).no_income_explanation if assets.matches('ira').item(0).value == 0 else ''}
      - "mutualfund_explanation": ${assets.matches('mutual fund').item(0).no_income_explanation if assets.matches('mutual fund').item(0).value == 0 else ''}
      - "mutalfund_owner": ${comma_and_list(assets.owners(type='mutual fund'))}
      - "mutualfund_amount": ${thousands(assets.balance_total(type='mutual fund'))}
      - "mutualfund_monthly": ${thousands(assets.total(type='mutual fund',period_to_use=12))}
      - "stocks_explanation":  ${assets.matches('stocks').item(0).no_income_explanation if assets.matches('stocks').item(0).value == 0 else ''}
      - "stocks_owner": ${comma_and_list(assets.owners(type='stocks'))}
      - "stocks_amount": ${thousands(assets.balance_total(type='stocks'))}
      - "stocks_monthly": ${thousands(assets.total(type='stocks',period_to_use=12))}
      - "trust_explanation":  ${assets.matches('trust').item(0).no_income_explanation if assets.matches('trust').item(0).value == 0 else ''}
      - "trust_owner": ${comma_and_list(assets.owners(type='trust'))}
      - "trust_amount": ${thousands(assets.balance_total(type='trust'))}
      - "trust_monthly": ${thousands(assets.total(type='trust',period_to_use=12))}
      - "checking_owner": ${comma_and_list(assets.owners(type='checking'))}
      - "checking_amount": ${thousands(assets.balance_total(type='checking'))}
      - "checking_monthly": ${thousands(assets.total(type='checking',period_to_use=12))}
      - "checking_explanation": ${assets.matches('checking').item(0).no_income_explanation if assets.matches('checking').item(0).value == 0 else ''}
      - "asset_other_owner": ${comma_and_list(assets.owners(type='other'))}
      - "asset_other_amount": ${thousands(assets.balance_total(type='other'))}
      - "asset_other_monthly": ${thousands(assets.total(type='other',period_to_use=12))}
      - "asset_other_explanation": ${assets.matches('other').item(0).no_income_explanation if assets.matches('other').item(0).value == 0 else ''}
      - "asset_other_description": ${asset_other_description}
      - "countable_asset_total_amount": ${thousands(assets.balance_total())}
      - "countable_asset_total_monthly": ${thousands(assets.total(period_to_use=12))}
      - "vehicle_owner_1": ${vehicles.item(0).owner}
      - "vehicle_year_make_model_1": ${vehicles.item(0).year_make_model() }
      - "vehicle_pv_1": ${thousands(vehicles.item(0).value)}
      - "vehicle_loan_balance_1": ${thousands(vehicles.item(0).balance)}
      - "vehicle_purpose_1": ${vehicles.item(0).primary_purpose}
      - "vehicle_owner_2": ${vehicles.item(1).owner}
      - "vehicle_year_make_model_2": ${vehicles.item(1).year_make_model() }
      - "vehicle_pv_2": ${thousands(vehicles.item(1).value)}
      - "vehicle_loan_balance_2": ${thousands(vehicles.item(1).balance)}
      - "vehicle_purpose_2": ${vehicles.item(1).primary_purpose}
      - "vehicle_owner_3": ${vehicles.item(2).owner}
      - "vehicle_year_make_model_3": ${vehicles.item(2).year_make_model() }
      - "vehicle_pv_3": ${thousands(vehicles.item(2).value)}
      - "vehicle_loan_balance_3": ${thousands(vehicles.item(2).balance)}
      - "vehicle_purpose_3": ${vehicles.item(2).primary_purpose}
      - "real_property_owner_1": ${real_estate.item(0).owner}
      - "real_property_description_1": ${real_estate.item(0).description}
      - "real_property_value_1": ${thousands(real_estate.item(0).market_value)}
      - "real_property_loan_balance_1": ${thousands(real_estate.item(0).balance)}
      - "real_property_income_1": ${currency(real_estate.item(0).amount(period_to_use=12), decimals=False)}
      - "real_property_owner_2": ${real_estate.item(1).owner}
      - "real_property_description_2": ${real_estate.item(1).description}
      - "real_property_value_2": ${thousands(real_estate.item(1).market_value)}
      - "real_property_loan_balance_2": ${thousands(real_estate.item(2).balance)}
      - "real_property_income_2": ${currency(real_estate.item(0).amount(period_to_use=12), decimals=False)}
      - "real_property_owner_3": ${real_estate.item(2).owner}
      - "real_property_description_3": ${real_estate.item(2).description}
      - "real_property_value_3": ${thousands(real_estate.item(2).market_value)}
      - "real_property_loan_balance_3": ${thousands(real_estate.item(2).balance)}
      - "real_property_income_3": ${currency(real_estate.item(2).amount(period_to_use=12), decimals=False)}
      - "real_property_owner_4": ${real_estate.item(3).owner}
      - "real_property_description_4": ${real_estate.item(3).description}
      - "real_property_value_4": ${thousands(real_estate.item(3).market_value)}
      - "real_property_loan_balance_4":  ${thousands(real_estate.item(3).balance)}
      - "real_property_income_4": ${currency(real_estate.item(3).amount(period_to_use=12), decimals=False)}
      - "user_employed_yes": ${yesno(client.jobs.there_are_any)}
      - "user_employed_no": ${noyes( client.jobs.there_are_any)}
      - "user_wages_gross": ${thousands(client.jobs.total(period_to_use=12))}
      - "user_wages_net": ${thousands(client.jobs.net_total(period_to_use=12))}
      - "user_employer_name_address_phone": ${client.jobs.item(0).name_address_phone()}
      - "spouse_employed_yes": ${yesno(spouse.jobs.there_are_any)}
      - "spouse_employed_no": ${noyes( spouse.jobs.there_are_any)}
      - "spouse_wages_gross": ${thousands(spouse.jobs.total(period_to_use=12))}
      - "spouse_wages_net": ${thousands(spouse.jobs.net_total(period_to_use=12))}
      - "spouse_employer_name_address_phone": ${spouse.jobs.item(0).name_address_phone()}
      - "dependent_employed_yes": ${yesno(household.jobs)}
      - "dependent_employed_no": ${noyes( household.jobs)}
      - "dependent_employed_names": ${household.jobs.item(0).whose_job}
      - "dependent_wages_gross": ${thousands(household.jobs.gross_total())}
      - "dependent_wages_net": ${thousands(household.jobs.net_total())}
      - "dependent_employer_name_address_phone": ${household.jobs.item(0).name_address_phone()}
      - "receive_support_yes": ${yesno(receives_support)}
      - "receive_support_no": ${noyes( receives_support)}
      - "receive_support_source": ${comma_and_list(support_sources)}
      - "receive_support_amount": ${thousands(client.incomes.total(type='other support') + spouse.incomes.total(type='other support') + household.incomes.total(type='other support'))}
      - "user_net_pay_total": ${thousands(client.jobs.net_total(period_to_use=12))}
      - "spouse_net_pay_total": ${thousands(spouse.jobs.net_total(period_to_use=12))}
      - "dependent_net_pay_total": ${thousands(household.jobs.net_total(period_to_use=12))}
      - "user_ss_total": ${currency(client.incomes.total(period_to_use=12, type='SSR'), decimals=False)}
      - "spouse_ss_total": ${currency(spouse.incomes.total(period_to_use=12, type='SSR'), decimals=False)}
      - "dependent_ss_total": ${currency(household.incomes.total(period_to_use=12, type='SSR'), decimals=False)}
      - "spouse_ssi_total": ${currency(spouse.incomes.total(period_to_use=12, type='SSI'), decimals=False)}
      - "user_ssi_total": ${currency(client.incomes.total(period_to_use=12, type='SSI'), decimals=False)}
      - "dependent_ssi_total": ${currency(household.incomes.total(period_to_use=12, type='SSI'), decimals=False)}
      - "pension_type_1": ${client.incomes.matches('pension').item(0).name + ' ' + spouse.incomes.matches('pension').item(0).name + ' ' + spouse.incomes.matches('pension').item(0).name}
      - "user_pension_1": ${currency(client.incomes.matches('pension').item(0).amount(period_to_use=12), decimals=False)}
      - "spouse_pension_1": ${currency(spouse.incomes.matches('pension').item(0).amount(period_to_use=12), decimals=False)}
      - "dependent_pension_1": ${currency(household.incomes.matches('pension').item(0).amount(period_to_use=12), decimals=False)}
      - "pension_type_2": ${client.incomes.matches('pension').item(1).name.full() + ' ' + spouse.incomes.matches('pension').item(1).name.full() + ' ' +  household.incomes.matches('pension').item(1).name.full()}
      - "user_pension_2": ${currency(client.incomes.matches('pension').item(1).amount(period_to_use=12), decimals=False)}
      - "spouse_pension_2": ${currency(spouse.incomes.matches('pension').item(1).amount(period_to_use=12), decimals=False)}
      - "dependent_pension_2": ${currency(household.incomes.matches('pension').item(1).amount(period_to_use=12), decimals=False)}
      - "other_assistance_type": ${client.incomes.matches('public assistance').item(0).name + ' ' + spouse.incomes.matches('public assistance').item(0).name + ' ' + household.incomes.matches('public assistance').item(0).name}
      - "user_other_assistance": ${currency(client.incomes.total(type='public assistance',period_to_use=12), decimals=False)}
      - "spouse_other_assistance": ${currency(spouse.incomes.total(type='public assistance',period_to_use=12), decimals=False)}
      - "dependent_other_assistance": ${currency(household.incomes.total(type='public assistance',period_to_use=12), decimals=False)}
      - "user_snap_total": ${currency(client.incomes.total(type='SNAP',period_to_use=12), decimals=False)}
      - "spouse_snap_total": ${currency(spouse.incomes.total(type='public assistance',period_to_use=12), decimals=False)}
      - "dependent_snap_total": ${currency(household.incomes.total(type='public assistance',period_to_use=12), decimals=False)}
      - "user_rent_income_total": ${currency(client.incomes.total(type='rent',period_to_use=12), decimals=False)}
      - "spouse_rent_income_total": ${currency(spouse.incomes.total(type='rent',period_to_use=12), decimals=False)}
      - "dependent_rent_income_total": ${currency(household.incomes.total(type='rent',period_to_use=12), decimals=False)}
      - "user_room_board_total": ${currency(client.incomes.total(type='room and board',period_to_use=12), decimals=False)}
      - "spouse_room_board_total": ${currency(spouse.incomes.total(type='room and board',period_to_use=12), decimals=False)}
      - "dependent_room_board_total": ${currency(household.incomes.total(type='room and board',period_to_use=12), decimals=False)}
      - "user_child_support_total": ${currency(client.incomes.total(type='child support',period_to_use=12), decimals=False)}
      - "spouse_child_support_total": ${currency(spouse.incomes.total(type='child support',period_to_use=12), decimals=False)}
      - "dependent_child_support_total": ${currency(household.incomes.total(type='child support',period_to_use=12), decimals=False)}
      - "user_other_support_total": ${currency(client.incomes.total(type='other support',period_to_use=12), decimals=False)}
      - "spouse_other_support_total": ${currency(spouse.incomes.total(type='other support',period_to_use=12), decimals=False)}
      - "dependent_other_support_total": ${currency(household.incomes.total(type='other support',period_to_use=12), decimals=False)}
      - "user_asset_income_total": ${currency(assets.total(owner=client,period_to_use=12), decimals=False)}
      - "spouse_asset_income_total": | 
          % if has_spouse: 
          ${currency(assets.total(owner=spouse,period_to_use=12), decimals=False)}
          % endif
      - "dependent_asset_income_total": | 
          % if household.there_are_any: 
          ${currency(assets.total(period_to_use=12) - assets.total(owner=client,period_to_use=12) - assets.total(owner=spouse,period_to_use=12), decimals=False)}
          % endif
      - "user_other_total": ${currency(client.incomes.total(type='other',period_to_use=12), decimals=False)}
      - "spouse_other_total": ${currency(spouse.incomes.total(type='other',period_to_use=12), decimals=False)}
      - "dependent_other_total": ${currency(household.incomes.total(type='other',period_to_use=12), decimals=False)}
      - "user_income_total": ${thousands(client.incomes.total(period_to_use=12) + assets.total(owner=client,period_to_use=12) + client.jobs.total(period_to_use=12))}
      - "spouse_income_total": | 
          % if has_spouse: 
          {thousands(spouse.incomes.total(period_to_use=12) + assets.total(owner=spouse,period_to_use=12) + spouse.jobs.total(period_to_use=12))}
          % endif$
      - "dependent_income_total": | 
          % if household.there_are_any: 
          ${thousands(household.incomes.total(period_to_use=12) + assets.total(period_to_use=12) - assets.total(owner=client,period_to_use=12) - assets.total(owner=spouse,period_to_use=12) + household.jobs.total(period_to_use=12))}
          % endif
      - "grand_total": ${thousands(grand_total)}
      - "remarks": ${room_and_board_explanation}
      #- "other_explanation": something # not used
      - "expense_rent": ${currency(expenses.total(type='rent',period_to_use=12) + expenses.total(type='mortgage',period_to_use=12), decimals=False)}
      - "expense_food": ${currency(expenses.total(type='food',period_to_use=12), decimals=False)}
      - "expense_utilities": ${currency(expenses.total(type='utilities',period_to_use=12), decimals=False)}
      - "expense_fuel": ${currency(expenses.total(type='fuel',period_to_use=12), decimals=False)}
      - "expense_clothing": ${currency(expenses.total(type='clothing',period_to_use=12), decimals=False)}
      - "expense_cc_minimum": ${currency(expenses.total(type='credit cards',period_to_use=12), decimals=False)}
      - "expense_property_tax": ${currency(expenses.total(type='property tax',period_to_use=12), decimals=False)}
      - "expense_fees": ${currency(expenses.total(type='other taxes',period_to_use=12), decimals=False)}
      - "expense_insurance_1": ${currency(expenses.matches('insurance').item(0).amount(period_to_use=12), decimals=False)}
      - "expense_insurance_2": ${currency(expenses.matches('insurance').item(1).amount(period_to_use=12), decimals=False)}
      - "expense_medical": ${currency(expenses.total(type='medical',period_to_use=12), decimals=False)}
      - "expense_car": ${currency(expenses.total(type='auto',period_to_use=12), decimals=False)}
      - "expense_transportation": ${currency(expenses.total(type='transportation',period_to_use=12), decimals=False)}
      - "expense_charity_1": ${currency(expenses.matches('charity').item(0).amount(period_to_use=12), decimals=False)}
      - "expense_charity_2": ${currency(expenses.matches('charity').item(1).amount(period_to_use=12), decimals=False)}
      - "expense_charity_3": ${currency(expenses.matches('charity').item(2).amount(period_to_use=12), decimals=False)}
      - "expense_loan_1": ${currency(expenses.matches('loan').item(0).amount(period_to_use=12), decimals=False)}
      - "expense_loan_2": ${currency(expenses.matches('loan').item(1).amount(period_to_use=12), decimals=False)}
      - "expense_support_1": ${currency(expenses.matches('support').item(0).amount(period_to_use=12), decimals=False)}
      - "expense_support_details": ${expense_support_details}
      - "expense_support_2": ${currency(expenses.matches('support').item(1).amount(period_to_use=12), decimals=False)}
      - "expenses_total": ${thousands(expenses.total(period_to_use=12))}
      - "expense_other_details": ${expense_other_details}
      - "expense_other":  ${currency(expenses.total(type='other',period_to_use=12), decimals=False)}
      - "monthly_income": ${thousands(grand_total)} 
      - "monthly_expenses": ${thousands(monthly_expenses)}
      - "adjusted_expenses": ${thousands(adjusted_expenses)}
      - "expenses_exceed_income_explanation": ${expenses_exceed_income_explanation if expenses_exceed_income else ''}
      - "financial_situation_will_change_yes": ${expect_change.any_true()}
      - "financial_situation_will_change_no": ${expect_change.all_false()}
      - "financial_situation_will_change_explanation": ${expect_change_explanation}
      - "cash_special_purpose_no_amount_on_hand": ${yesno(cash_special_purpose_no_money_on_hand)}
      - "cash_special_purpose_money_available": ${noyes(cash_kept_special_purpose)}
      - "cash_special_purpose_money_needed": ${yesno(cash_kept_special_purpose)}
      - "special_purpose_explanation": ${accounts_special_purpose_explanation}
      - "cant_convert_countable_asset_yes": ${yesno(assets_cannot_be_converted) if non_cash_assets else ''}
      - "cant_convert_countable_asset_no": ${noyes(assets_cannot_be_converted) if non_cash_assets else ''}
      - "cant_convert_countable_asset_explanation": ${assets_cannot_be_converted_explanation if non_cash_assets and assets_cannot_be_converted else ''}
      - "cant_convert_property_yes": ${yesno(assets_cannot_be_sold) if has_sellable_assets else ''}
      - "cant_convert_property_no": ${noyes(assets_cannot_be_sold) if has_sellable_assets else ''}
      - "cant_convert_property_explanation": ${assets_cannot_be_sold_explanation if has_sellable_assets and assets_cannot_be_sold else ''}
      #- "remarks_continued": something # TODO ? maybe not needed
      #- "remarks_continued_more": something # TODO?
      - "signature": ${client.signature if defined('client.signature') else ''}
      - "signature_date": ${today()}
      - "phone_work": ${client.phone_work}
      - "phone_home": ${client.phone_number}
      - "user_mailing_address": ${client.address.address}
      - "user_city_state": ${client.address.city + ' ' + client.address.state}
      - "user_zip": ${ client.address.zip}
      - "user_county": ${ client.address.county}